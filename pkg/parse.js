import{unified as t}from"unified";import n from"remark-parse";import e from"remark-gfm";import r from"@sindresorhus/slugify";import i from"remark-stringify";import o from"strip-final-newline";import{isMatch as u,parse as a}from"date-fns";import{zonedTimeToUtc as f,formatInTimeZone as c}from"date-fns-tz/esm";function l(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}var h=["yyyy-MM-dd","dd/MM/yyyy","dd/MM/yy","dd-MM-yyyy","dd-MM-yy","dd.MM.yyyy","dd.MM.yy"],d=["HH:mm","HH.mm","hh:mm a","hh:mm A"],s=function t(n){return n.children.map(function(e){var r={};return"list"===e.type?t(n):"listItem"===e.type?(r.checked=e.checked,e.children.map(function(t){if("paragraph"===t.type)return r.text=t.children.map(function(t){return"link"===t.type?t.children[0].value:t.value}).filter(function(t){return!!t}).join(""),r}).filter(function(t){return!!t})):void 0}).filter(function(t){return!!t})};function m(t,n,e){if(!t.s){if(e instanceof y){if(!e.s)return void(e.o=m.bind(null,t,n));1&n&&(n=e.s),e=e.v}if(e&&e.then)return void e.then(m.bind(null,t,n),m.bind(null,t,2));t.s=n,t.v=e;var r=t.o;r&&r(t)}}var p=function(p){try{var g,b,M,x,w,k,O,A,I,j,H,S,T;return Promise.resolve(t().use(n).use(e).parse(p)).then(function(n){function p(){for(H in C)(T=(S=C[H]).content.filter(Boolean))&&T.length>0&&(1===T.length&&(S.text=T[0]),S.text=T.join("\n\n")),S.content=T;return C}if(!n)return[];var C={},U=null;g=function(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(e)return(e=e.call(t)).next.bind(e);if(Array.isArray(t)||(e=function(t,n){if(t){if("string"==typeof t)return l(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?l(t,n):void 0}}(t))){e&&(t=e);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(n.children);var E=function(t,n,e){for(var r;;){var i=t();if(v(i)&&(i=i.v),!i)return o;if(i.then){r=0;break}var o=e();if(o&&o.then){if(!v(o)){r=1;break}o=o.s}}var u=new y,a=m.bind(null,u,2);return(0===r?i.then(c):1===r?o.then(f):(void 0).then(function(){(i=t())?i.then?i.then(c).then(void 0,a):c(i):m(u,1,o)})).then(void 0,a),u;function f(n){o=n;do{if(!(i=t())||v(i)&&!i.v)return void m(u,1,o);if(i.then)return void i.then(c).then(void 0,a);v(o=e())&&(o=o.v)}while(!o||!o.then);o.then(f).then(void 0,a)}function c(t){t?(o=e())&&o.then?o.then(f).then(void 0,a):f(o):m(u,1,o)}}(function(){return!(b=g()).done},0,function(){return M=b.value,Promise.resolve(t().use(e).use(i).stringify(M)).then(function(t){var n,e;(x=o(t)).indexOf("\\_")>-1&&(x=x.replace(/\\_/g,"_")),"heading"===M.type&&3===M.depth?(U=r(M.children[0].value),C[U]={title:M.children[0].value,content:[]}):"paragraph"===M.type&&U?(w=C[U],n=x,e=h.map(function(t){return u(n,t)}),k=e.indexOf(!0)>-1?f(a(n,h[e.indexOf(!0)],new Date),"UTC").toJSON().split("T")[0]:null,O=function(t){var n=d.map(function(n){return u(t,n)});if(n.indexOf(!0)>-1){var e=f(a(t,d[n.indexOf(!0)],new Date),"UTC");return c(e,"UTC","HH:mm")}return null}(x),A=function(t){var n=!1,e={hours:0,minutes:0},r=new RegExp(/([0-9]+)h([0-9]+)m/),i=new RegExp(/([0-9]+)h/);if(t.match(r)){n=!0;var o=t.match(r),u=o[2];e.hours=parseInt(o[1]),e.minutes=parseInt(u)}else if(t.match(i)){n=!0;var a=t.match(i);e.hours=parseInt(a[1]),e.minutes=0}return n?e:null}(x),k&&(w.date=k),O&&(w.time=O),A&&(w.duration=A),w.content.push(x)):"list"===M.type?((I=C[U]).text=x,I.list=s(M).flat()):"html"===M.type?C[U].content.push(M.html):"code"===M.type?((j=C[U]).lang=M.lang,j.text=x):"heading"===M.type&&M.depth>3?C[U].content.push(M.children[0].value):(console.log("unhandled token type"),console.log(M))})});return E&&E.then?E.then(p):p()})}catch(t){return Promise.reject(t)}};const y=/*#__PURE__*/function(){function t(){}return t.prototype.then=function(n,e){const r=new t,i=this.s;if(i){const t=1&i?n:e;if(t){try{m(r,1,t(this.v))}catch(t){m(r,2,t)}return r}return this}return this.o=function(t){try{const i=t.v;1&t.s?m(r,1,n?n(i):i):e?m(r,1,e(i)):m(r,2,i)}catch(t){m(r,2,t)}},r},t}();function v(t){return t instanceof y&&1&t.s}export{p as default};
//# sourceMappingURL=parse.js.map
