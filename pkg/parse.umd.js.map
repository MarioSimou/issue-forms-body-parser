{"version":3,"file":"parse.umd.js","sources":["../src/parsers/date.js","../src/parsers/time.js","../src/parsers/index.js","../src/parsers/list.js","../src/parse.js","../src/index.js","../src/parsers/duration.js"],"sourcesContent":["'use strict'\n\nimport { parse, isMatch } from 'date-fns'\nimport { zonedTimeToUtc } from 'date-fns-tz/esm'\n\nconst loc = 'UTC'\nconst commonDateFormats = [\n  'yyyy-MM-dd',\n  'dd/MM/yyyy',\n  'dd/MM/yy',\n  'dd-MM-yyyy',\n  'dd-MM-yy',\n  'dd.MM.yyyy',\n  'dd.MM.yy'\n]\n\nexport default function parseDate(text) {\n  const match = commonDateFormats.map((format) => {\n    return isMatch(text, format)\n  })\n  if (match.indexOf(true) > -1) {\n    const date = zonedTimeToUtc(\n      parse(text, commonDateFormats[match.indexOf(true)], new Date()),\n      loc\n    ).toJSON()\n    return date.split('T')[0]\n  } else {\n    return null\n  }\n}\n","'use strict'\n\nimport { parse, isMatch } from 'date-fns'\nimport { zonedTimeToUtc, formatInTimeZone } from 'date-fns-tz/esm'\n\nconst loc = 'UTC'\nconst commonTimeFormats = ['HH:mm', 'HH.mm', 'hh:mm a', 'hh:mm A']\n\nexport default function parseTime(text) {\n  const match = commonTimeFormats.map((format) => {\n    return isMatch(text, format)\n  })\n  if (match.indexOf(true) > -1) {\n    const time = zonedTimeToUtc(\n      parse(text, commonTimeFormats[match.indexOf(true)], new Date()),\n      loc\n    )\n    return formatInTimeZone(time, loc, 'HH:mm')\n  } else {\n    return null\n  }\n}\n","'use strict'\n\nimport date from './date.js'\nimport time from './time.js'\nimport duration from './duration.js'\nimport list from './list.js'\n\nexport const parseDate = date\nexport const parseTime = time\nexport const parseDuration = duration\nexport const parseList = list\n","'use strict'\n\nexport default function parseList(list) {\n  return list.children\n    .map((item) => {\n      const listItem = {}\n      if (item.type === 'list') {\n        return parseList(list)\n      } else if (item.type === 'listItem') {\n        listItem.checked = item.checked\n        return item.children\n          .map((child) => {\n            if (child.type === 'paragraph') {\n              listItem.text = child.children\n                .map((c) => {\n                  if (c.type === 'link') {\n                    return c.children[0].value\n                  } else {\n                    return c.value\n                  }\n                })\n                .filter((x) => !!x)\n                .join('')\n              return listItem\n            }\n          })\n          .filter((x) => !!x)\n      }\n    })\n    .filter((x) => !!x)\n}\n","'use strict'\n\nimport { unified } from 'unified'\nimport remarkParse from 'remark-parse'\nimport remarkGfm from 'remark-gfm'\nimport slugify from '@sindresorhus/slugify'\nimport remarkStringify from 'remark-stringify'\nimport stripFinalNewline from 'strip-final-newline'\n\nimport {\n  parseDate,\n  parseTime,\n  parseDuration,\n  parseList\n} from './parsers/index.js'\n\nexport default async function parseMD(body) {\n  const tokens = await unified().use(remarkParse).use(remarkGfm).parse(body)\n  if (!tokens) {\n    return []\n  }\n\n  const structuredResponse = {}\n  let currentHeading = null\n  for (const token of tokens.children) {\n    const text = await unified()\n      .use(remarkGfm)\n      .use(remarkStringify)\n      .stringify(token)\n    const cleanText = stripFinalNewline(text)\n\n    // issue forms uses h3 as a heading\n    if (token.type === 'heading' && token.depth === 3) {\n      currentHeading = slugify(token.children[0].value)\n      structuredResponse[currentHeading] = {\n        title: token.children[0].value,\n        content: []\n      }\n    } else if (token.type === 'paragraph' && currentHeading) {\n      const obj = structuredResponse[currentHeading]\n\n      const date = parseDate(cleanText)\n      const time = parseTime(cleanText)\n      const duration = parseDuration(cleanText)\n\n      if (date) {\n        obj.date = date\n      }\n\n      if (time) {\n        obj.time = time\n      }\n\n      if (duration) {\n        obj.duration = duration\n      }\n\n      obj.content.push(cleanText)\n    } else if (token.type === 'list') {\n      const obj = structuredResponse[currentHeading]\n      obj.text = cleanText\n      obj.list = parseList(token).flat()\n    } else if (token.type === 'html') {\n      const obj = structuredResponse[currentHeading]\n      obj.content.push(token.html)\n    } else if (token.type === 'code') {\n      const obj = structuredResponse[currentHeading]\n      obj.lang = token.lang\n      obj.text = cleanText\n    } else if (token.type === 'heading' && token.depth > 3) {\n      const obj = structuredResponse[currentHeading]\n      obj.content.push(token.children[0].value)\n    } else {\n      console.log('unhandled token type')\n      console.log(token)\n    }\n  }\n\n  for (const key in structuredResponse) {\n    const token = structuredResponse[key]\n    const content = token.content.filter(Boolean)\n    if (content && content.length > 0) {\n      if (content.length === 1) {\n        token.text = content[0]\n      }\n      token.text = content.join('\\n\\n')\n    }\n    token.content = content\n  }\n\n  return structuredResponse\n}\n","'use strict'\n\nimport github from '@actions/github'\nimport core from '@actions/core'\nimport parse from './parse.js'\n\nasync function run() {\n  core.info('Parsing issue body ...')\n\n  try {\n    const parsedContent = await parse(github.context.payload.issue.body)\n\n    if (parsedContent !== undefined) {\n      core.setOutput('data', parsedContent)\n    } else {\n      core.setFailed(`There was no valid payload found in the issue.`)\n    }\n  } catch (err) {\n    core.setFailed(err)\n  }\n}\n\nrun()\n","'use strict'\n\nexport default function parseDuration(text) {\n  let matched = false\n  const duration = {\n    hours: 0,\n    minutes: 0\n  }\n\n  const hoursAndMinutes = new RegExp(/([0-9]+)h([0-9]+)m/)\n  const hours = new RegExp(/([0-9]+)h/)\n\n  if (text.match(hoursAndMinutes)) {\n    matched = true\n    const [, h, m] = text.match(hoursAndMinutes)\n    duration.hours = parseInt(h)\n    duration.minutes = parseInt(m)\n  } else if (text.match(hours)) {\n    matched = true\n    const [, h] = text.match(hours)\n    duration.hours = parseInt(h)\n    duration.minutes = 0\n  }\n\n  if (matched) {\n    return duration\n  } else {\n    return null\n  }\n}\n"],"names":["commonDateFormats","commonTimeFormats","parseList","list","children","map","item","listItem","type","checked","child","text","c","value","filter","x","join","_settle","pact","state","s","_Pact","o","bind","v","then","observer","prototype","onFulfilled","onRejected","result","this","callback","e","_this","thenable","core","info","_temp2","body","recover","parse","token","cleanText","obj","date","time","duration","key","content","unified","use","remarkParse","remarkGfm","tokens","structuredResponse","Boolean","length","currentHeading","_iterator","test","update","stage","shouldContinue","_isSettledPact","reject","_resumeAfterTest","_resumeAfterBody","updateValue","remarkStringify","stringify","match","stripFinalNewline","depth","slugify","title","format","isMatch","indexOf","zonedTimeToUtc","Date","toJSON","split","parseTime","formatInTimeZone","matched","hours","minutes","hoursAndMinutes","RegExp","_text$match","m","parseInt","parseDuration","push","flat","html","lang","console","log","_temp","github","context","payload","issue","parsedContent","undefined","setOutput","setFailed","_catch","err","Promise","resolve","run"],"mappings":"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"}